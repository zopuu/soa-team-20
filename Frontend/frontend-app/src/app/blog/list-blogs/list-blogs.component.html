<div class="list-wrapper">
  <h2 *ngIf="userId; else allTitle">Blogs by user {{ userId }}</h2>
  <ng-template #allTitle><h2>All Blogs</h2></ng-template>

  <div class="state" *ngIf="loading">Loading‚Ä¶</div>
  <div class="state" *ngIf="!loading && blogs.length === 0">Follow people to see their blogs.</div>
  <div class="state error" *ngIf="error">{{ error }}</div>

  <div class="blog-list" *ngIf="!loading && !error">
    <div class="blog-card" *ngFor="let b of blogs; trackBy: trackById">
      <h3 class="title">{{ b.title }}</h3>
      <p class="desc">{{ b.description }}</p>
      <div class="meta">
        <span>{{ b.date_of_creation | date : "medium" }}</span>
        <span> ‚Ä¢ by {{ b.userId }}</span>
      </div>
      <button
          (click)="delete(b)"
          [disabled]="false">
          Delete
        </button>
      <div class="images" *ngIf="b.images?.length">
        <div class="image-gallery">
          <img
            *ngFor="let img of b.images; let i = index"
            [src]="createImageDataUrl(img || '', img || '')"
            [alt]="img || 'Blog image '"
            class="blog-image"
            (error)="onImageError($event)"
          />
        </div>
      </div>
    

    <!-- Likes Section -->
      <div class="likes" *ngIf="userId">
        <button
          (click)="toggleLike(b)"
          [disabled]="false">
          {{ hasLiked(b) ? 'üëé Unlike' : 'üëç Like' }}
        </button>
        <span>{{ blogLikes[b.id]?.length || 0 }} likes</span>
      </div>

      <div class="comments">
  <h4>Comments ({{ blogComments[b.id]?.length || 0 }})</h4>
  <div *ngIf="blogComments[b.id] && blogComments[b.id].length > 0; else noComments">
    <div class="comment" *ngFor="let c of blogComments[b.id]">
      <strong>{{ c.userId }}</strong>: {{ c.text }}
      <span style="font-size:0.8em;color:#888;">({{ c.dateOfCreation | date:'short' }})</span>
    </div>
  </div>
  <ng-template #noComments>
    <div class="state">No comments yet.</div>
  </ng-template>

  <!-- Add Comment Form -->
  <form *ngIf="userId" (ngSubmit)="addComment(b)" class="add-comment">
    <input
      type="text"
      [(ngModel)]="newCommentText[b.id]"
      name="comment-{{b.id}}"
      placeholder="Write a comment‚Ä¶"
      required
    />
    <button type="submit" [disabled]="!newCommentText[b.id]">Post</button>
  </form>
</div>
    </div>

    <div *ngIf="blogs.length === 0" class="state">No blogs found.</div>
  </div>
  <div class="state" *ngIf="!loading && blogs.length === usersBlogsNumber">Follow people to see their blogs.</div>
</div>
